{% extends 'base.html.twig' %}{% block title %}SnowTricks - Accueil{% endblock %}{% block body %}{% include 'header.html.twig' %}
<div class="main">
	<div class="shop_top">
		<div class="container">
			<center>
				<img src="{{ asset('images/tricks/'~ trick.main_image ~'') }}" class="img-responsive" style="width: 100%; z-index: 0;" alt=""/>
			</center>
			<br />
			<center>
				<h1>{{ trick.name }}</h1>{% if is_granted('ROLE_ADMIN') %}<a href="{{ path('trick_edit', {'id': app.request.get('trickid') }) }}"><img src="{{ asset('images/edit.png') }}"/></a> <a href="{{ path('trick_delete', {'id': app.request.get('trickid') }) }}" onclick="return confirm('Etes-vous sûr de vouloir supprimer cette figure?')"><img src="{{ asset('images/delete.png') }}"/></a>{% endif %}
			<br /> Posté par <strong>{{ trick.author.firstname }} {{ trick.author.lastname }}</strong> le {{ trick.created_at | date('d/m/Y') }} | Catégorie : {{ trick.category.name }} 
			</center>
			<div class="row d-none d-lg-flex load-media">
				<div class="col-lg-6 col-md-12">
					<div id="carousel" class="carousel slide mt-3 mb-2" data-ride="carousel">
						<ol class="carousel-indicators">
							{% for key, picture in pictures %}
							<li data-target=".carousel" data-slide-to="{{ key }}"  {% if key == 0 %}class="active"{% endif %} ></li>
							{% endfor %}
						</ol>
						<div class="carousel-inner enlarge">
							{% for key, picture in pictures %}
							<div class="carousel-item  {% if key == 0 %}active{% endif %} ">
								<img class="d-block" src="{{ asset('images/tricks/'~ picture.name ~'') }}" width="497" height="356">
								{% if is_granted('ROLE_ADMIN') %}<br /><center><a href="{{ path('media_delete', {'trickid': app.request.get('trickid'), 'id': picture.id }) }}" onclick="return confirm('Etes-vous sûr de vouloir supprimer cette image?')">Supprimer cette image</a></center>{% endif %}
							</div>
							{% endfor %}
						</div>
						<a class="carousel-control-prev" href="#carousel" data-slide="prev"><span class="carousel-control-prev-icon"></span></a>
						<a class="carousel-control-next" href="#carousel" data-slide="next"><span class="carousel-control-next-icon"></span></a>
					</div>
					{% if is_granted('ROLE_ADMIN') %}
					<h4 class="m_11">Ajouter une image</h4>
					{{ form_start(formPictures) }}   
					<div class="input-file-container">
						{{ form_widget(formPictures.name, {'attr': {'class': 'input-file'}}) }}
						<label tabindex="0" for="my-file" class="input-file-trigger">Ajouter une image </label>
						<p></p>
						{{ form_widget(formPictures.idtrick, {'attr': {'value': app.request.get('trickid')}}) }}
						<input name="submit" type="submit" id="submit" value="Envoyer">
					</div>
					{{ form_end(formPictures) }}
					{% endif %}
				</div>
				<div class="col-lg-6 col-md-12">
					<div id="carousel-v" class="carousel slide mt-3 mb-2" data-ride="carousel">
						<ol class="carousel-indicators">
							{% for key, video in videos %}
							<li data-target="#carousel-v" data-slide-to="{{ key }}"  {% if key == 0 %}class="active"{% endif %} ></li>
							{% endfor %}
						</ol>
						<div class="carousel-inner">
							{% for key, video in videos %}
							<div class="carousel-item  {% if key == 0 %}active{% endif %} ">
								{{ video.code|raw }}
								{% if is_granted('ROLE_ADMIN') %}<br /><center style="margin-top:0.9rem;"><a href="{{ path('media_delete', {'trickid': app.request.get('trickid'), 'id': video.id }) }}" onclick="return confirm('Etes-vous sûr de vouloir supprimer cette vidéo?')">Supprimer cette vidéo</a></center>{% endif %}
							</div>
							{% endfor %}
						</div>
						<a class="carousel-control-prev" href="#carousel-v" data-slide="prev"><span class="carousel-control-prev-icon"></span></a>
						<a class="carousel-control-next" href="#carousel-v" data-slide="next"><span class="carousel-control-next-icon"></span></a>
					</div>
					{% if is_granted('ROLE_ADMIN') %}
					<h4 class="m_11">Ajouter une vidéo (code d'intégration)</h4>
					{{ form_start(formVideos) }}
                    {{ form_widget(formVideos.code, {'attr': {'style': 'height: 80px; width: 100%;' }}) }}
                    {{ form_widget(formVideos.idtrick, {'attr': {'value': app.request.get('trickid') }}) }}
                    <br />
						<input name="submit" type="submit" id="submit" value="Envoyer">
						<br>
					{{ form_end(formVideos) }}
					{% endif %}
				</div>
			</div>
			<div class="text-center">
				<a href="#" id="loadMedia" class="d-md-block d-lg-none"><button class="btn btn-outline-secondary">Afficher les médias</button></a>
				<a href="#" id="hideMedia" class="d-none d-md-none d-lg-none"><button class="btn btn-outline-secondary mt-3">Masquer les médias</button></a>
			</div>
			<div class="desc">
				<br />
				<center>
					<h3>Description</h3>
				</center>
				<p>
					{{ trick.description }}
				</p>
			</div>
			<div id="comment-form">
					{% for message in app.flashes('success') %}
            <div class="alert alert-success">
                {{ message }}
            </div>
        {% endfor %}
			<h4 class="m_11">Commentaires sur cette figure</h4>
			{% if is_granted('ROLE_USER') or is_granted('ROLE_ADMIN') %}
			{{ form_start(formView) }}
            {{ form_widget(formView.content, {'attr': {'value': 'Poster un commentaire', 'style': 'width: 100%; height: 80px;' }}) }}
            {{ form_widget(formView.idtrick, {'attr': {'value': app.request.get('trickid') }}) }}
            
			
				<input name="submit" type="submit" id="submit" value="Envoyer">
				
			
			{{ form_end(formView) }}
			{% else %}
			Veuillez <a href="{{ path('app_login') }}">vous connecter</a> pour poster un commentaire.
			{% endif %}
			<br />
			</div>

			<div class="row">
			{% if is_granted('ROLE_ADMIN') %}
				{% for pending in pendingcomments %}
				<div class="col-md-4 product1">
					<img src="images/s1.jpg" class="img-responsive" alt=""/>
					<div class="shop_desc" style="background-color: orange;">
						<a href="#"></a>
						<h3>
							<a href="#"></a>
							<a href="#">{% if pending.user.profile_picture %} <img src="{{ asset('images/profile_pictures/'~ pending.user.profile_picture ~'') }}" height="50" width="50" style="border-radius: 50%;" alt=""/>{% else %} <img src="{{ asset('images/profile_pictures/default.jpg') }}" height="50" width="50" style="border-radius: 50%;" alt=""/>{% endif %}{{ pending.user.lastname }} {{ pending.user.firstname }}</a>
						</h3>
						<p>
							{{ pending.content }} 
						</p>
						<ul class="buttons">
							<li class="cart"><a href="#">{{ pending.date |date('d-m-Y') }}</a></li>
							<li class="shop_btn"><a href="{{ path('comment_validation', {'trickid': app.request.get('trickid'), 'id': pending.id }) }}" onclick="return confirm('Etes-vous sûr de vouloir valider ce commentaire?')">Valider </a></li>
							<li class="shop_btn" style="margin-right: 0.5rem;"><a href="{{ path('comment_delete', {'trickid': app.request.get('trickid'), 'id': pending.id }) }}" onclick="return confirm('Etes-vous sûr de vouloir supprimer ce commentaire?')"> Supprimer</a></li>
							<div class="clear"></div>
						</ul>
					</div>
				</div>
				{% endfor %}
			{% endif %}

				{% for comment in comments %}

				<div class="col-md-4 trick">
					<img src="images/s1.jpg" class="img-responsive" alt=""/>
					<div class="shop_desc">
						<a href="#"></a>
						<h3>
							<a href="#"></a>
							<a href="#">{% if comment.user.profile_picture %} <img src="{{ asset('images/profile_pictures/'~ comment.user.profile_picture ~'') }}" height="50" width="50" style="border-radius: 50%;" alt=""/>{% else %} <img src="{{ asset('images/profile_pictures/default.jpg') }}" height="50" width="50" style="border-radius: 50%;" alt=""/>{% endif %} {{ comment.user.lastname }} {{ comment.user.firstname }}</a>
						</h3>
						<p>
							{{ comment.content }} 
						</p>
						<ul class="buttons">
							<li class="cart"><a href="#">{{ comment.date | date('d/m/Y') }}</a></li>
							{% if is_granted('ROLE_ADMIN') %}<li class="shop_btn"><a href="{{ path('comment_delete', {'trickid': app.request.get('trickid'), 'id': comment.id }) }}" onclick="return confirm('Etes-vous sûr de vouloir supprimer ce commentaire?')">Supprimer</a></li>{% endif %}
							<div class="clear"></div>
						</ul>
					</div>
					
				</div>
				{% endfor %}
				
			</div>
			<div class="row justify-content-center m-3">
			<a href="#" id="loadMoreTrick"><img src="{{ asset('images/loadmore.png') }}"></a>
			</div>
		</div>
	</div>
</div>

<script>

$(function () {
    $("div.trick").slice(3, $("div.trick").length).hide();
    $("#loadMoreTrick").on('click', function (e) {
        e.preventDefault();
        $("div.trick:hidden").slice(0, 3).slideDown();
        if ($("div.trick:hidden").length == 0) {
            $("#loadMoreTrick").hide('slow');
            $("#loadLessTrick").show('slow');
        }
    });
    $("#loadLessTrick").on('click', function (e) {
        e.preventDefault();
        $("div.trick").slice(3, $("div.trick").length).hide();
        $("#loadLessTrick").hide('slow');
        $("#loadMoreTrick").show('slow');

    });
});

$(function () {
    $("#loadMedia").on('click', function (e) {
        e.preventDefault();
        $("div.load-media").removeClass('d-none');
        $("#loadMedia").addClass('d-none');
        $("#hideMedia").removeClass('d-none');
    });
    $("#hideMedia").on('click', function (e) {
        e.preventDefault();
        $("div.load-media").addClass('d-none');
        $("#loadMedia").removeClass('d-none');
        $("#hideMedia").addClass('d-none');
    });

});

</script>

{% include 'footer.html.twig' %}

{% endblock %}
